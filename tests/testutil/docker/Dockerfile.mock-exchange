# Dockerfile for Mock Exchange Server
FROM golang:1.21-alpine AS builder

WORKDIR /app

# Copy test utilities
COPY tests/testutil/exchange /app/exchange
COPY tests/testutil/go.mod /app/go.mod
COPY tests/testutil/go.sum /app/go.sum

# Download dependencies
RUN go mod download

# Build mock exchange server
RUN go build -o /mock-exchange /app/exchange/cmd/server/main.go

# Final stage
FROM alpine:latest

RUN apk --no-cache add ca-certificates

WORKDIR /root/

COPY --from=builder /mock-exchange .

EXPOSE 8545 8546

CMD ["./mock-exchange"]
